var that;
var db;

function Movie(options) {
	EventEmitter.call(this);
	
	that = this;
	
	if (typeof(options.db) !== 'undefined') {
		db = options.db;
	} else {
		db = new DB();
	}
	
	if (typeof(options.id) !== 'undefined') {
		that.id = that.setId(options.id);
	}
}

Movie.prototype.id = null;

Movie.prototype.setId = function (id) {
	that.id = Math.abs(parseInt(id));
}

Movie.prototype.load = function (id) {
	if (typeof(id) !== 'undefined') {
		that.id = that.setId(id);
	}
	
	var clauses = {};
	clauses.where = { id: that.id };
	
	db.select('movie', clauses, function (rows, fields) {
		console.log(rows, fields);
		
		that.emit('loaded');
	});
}

Movie.prototype.save = function () {
	if (that.id) {
		var dummy = {};
		
		for (var p in that) {
			if (p !== 'id') {
				dummy[p] = that[p];
			}
		}
		
		db.update('movies', dummy, { id: that.id });
	} else {
		db.insert('movies', that);
	}
}